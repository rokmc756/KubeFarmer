---
#
- name: Enable Firewalld for All Nodes
  systemd:
    name: firewalld
    state: started
    enabled: yes

#
- name: Allow Kubernetes Service Ports for Master Node
  firewalld:
    permanent: yes
    immediate: yes
    port: "{{ item.port }}/{{ item.proto }}"
    state: "{{ item.state }}"
    zone: "{{ item.zone }}"
  with_items: "{{ master_ports }}"
  when: inventory_hostname in groups['master']

#
- name: Allow Kubernetes Service Ports for Workder Nodes
  firewalld:
    permanent: yes
    immediate: yes
    port: "{{ item.port }}/{{ item.proto }}"
    state: "{{ item.state }}"
    zone: "{{ item.zone }}"
  with_items: "{{ workers_ports }}"
  when: inventory_hostname in groups['workers']

#
- name: Reload Firewalld for All Nodes
  command: firewall-cmd --reload

#
- name: Stop Firewalld for All Nodes
  systemd:
    name: firewalld
    state: stopped
    enabled: yes

#
- name: Disabling SELinux to be required by Kubnernates Cluster
  selinux:
    state: disabled
  register: selinux_disabled
  notify:
    - Restart system
    - Waiting for server to come back after reboot
  failed_when: selinux_disabled.msg | default('ok', True) is not search('(^ok$|libselinux-python|(SELinux state changed))')

#
- debug:
    var: selinux_disabled.stdout_lines
  when: print_debug == true

#
- name: Check if SELinux has been Disabled in Configurtion File
  command: grep SELINUX /etc/sysconfig/selinux
  register: sevalue

#
- debug:
    var: sevalue.stdout_lines
  when: print_debug == true

