---
# Deploy Kubernetes Cluster

# for now fail if it's not a Red Hat based system
- name: Check OS ( Kubernetes )
  fail: msg="Not a Red Hat based system!"
  when: ansible_os_family != 'RedHat' or  ansible_os_family != 'CentOS' or  ansible_os_family != 'Rocky'

#
- name: Set facts for network and packages informations for Linux Distribution
  import_tasks: set-k8s-facts.yml
  tags:
    - install
    - uninstall
    - reinit
  when: inventory_hostname in groups['master'] or inventory_hostname in groups['slave'] or inventory_hostname in groups['workers']

#
- name: Install Prerequistes Packages
  import_tasks: install-deps-pkgs.yml
  tags: install
  when: inventory_hostname in groups['master'] or inventory_hostname in groups['slave'] or inventory_hostname in groups['workers']

#
- name: Configure Firewall
  import_tasks: firewall.yml
  tags: install
  when: inventory_hostname in groups['master'] or inventory_hostname in groups['slave'] or inventory_hostname in groups['workers']

#
- name: Launch Kubernetes Software
  import_tasks: install.yml
  tags: install
  when: inventory_hostname in groups['master'] or inventory_hostname in groups['slave'] or inventory_hostname in groups['workers']

#
- name: Initialize Kubernetes Cluster
  import_tasks: initialize-k8s.yml
  tags: install
  when: inventory_hostname in groups['master'] or inventory_hostname in groups['slave'] or inventory_hostname in groups['workers']

#
- name: Reinitialize Kubernetes Cluster
  import_tasks: reinit.yml
  tags: reinit
  when: inventory_hostname in groups['master'] or inventory_hostname in groups['slave'] or inventory_hostname in groups['workers']

#
- name: Uninstall Kubernetes Cluster
  import_tasks: uninstall.yml
  tags: uninstall
  when: inventory_hostname in groups['master'] or inventory_hostname in groups['slave'] or inventory_hostname in groups['workers']

#
- name: Upgrade Kubernetes Cluster
  import_tasks: upgrade.yml
  tags: upgrade
  when: inventory_hostname in groups['master'] or inventory_hostname in groups['slave'] or inventory_hostname in groups['workers']

