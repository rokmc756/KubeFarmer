---
- name: Check OS ( Korifi )
  fail: msg="Not a Red Hat or SuSE based system!"
  when: ansible_os_family != 'RedHat' or  ansible_os_family != 'CentOS' or  ansible_os_family != 'Rocky' or ansible_os_family != 'Suse' or ansible_os_family != 'Ubuntu' or ansible_os_family != 'Debian'


- name: Set Facts for Network and Packages Informations
  import_tasks: set-facts.yml
  tags: prepare, install, uninstall, deploy, enable, destroy, disable, create, delete, clean


- name: Enable Helm Repository
  import_tasks: enable-helm-repo.yml
  tags: install, enable
  when: ( repo is defined and repo == true ) and inventory_hostname in groups['master']


- name: Install GO
  import_tasks: install-go.yml
  tags: install
  when: ( go is defined and go == true ) and inventory_hostname in groups['master']


- name: Install Kustomize
  import_tasks: install-kustomize.yml
  tags: install
  when: _kustomize.install == true and inventory_hostname in groups['master']


- name: Install Cert Manager
  import_tasks: install-cert-manager.yml
  tags: install
  when: ( cm is defined and cm == true ) and inventory_hostname in groups['master']


- name: Install K8S CLIs
  import_tasks: install-cli.yml
  tags: install
  when: ( cli is defined and cli == true ) and inventory_hostname in groups['master']


- name: Prepare Korifi
  import_tasks: prepare-korifi.yml
  tags: prepare
  when: ( korifi is defined and korifi == true ) and inventory_hostname in groups['master']


- name: Install Korifi
  import_tasks: install-korifi.yml
  tags: deploy
  when: ( korifi is defined and korifi == true ) and inventory_hostname in groups['master']


- name: Create CF Admin
  import_tasks: create-cf-admin.yml
  tags: create, install
  when: ( admin is defined and admin == true ) and inventory_hostname in groups['master']


- name: Distribute Applictions
  import_tasks: deploy-apps.yml
  tags: deploy, install
  when: ( apps is defined and apps == true ) and inventory_hostname in groups['master']


- name: Delete CF Admin
  import_tasks: delete-cf-admin.yml
  tags: delete, uninstall
  when: ( admin is defined and admin == true ) and inventory_hostname in groups['master']


#- name: Destroy Korifi
#  import_tasks: destroy-korifi.yml
#  tags: destroy, uninstall
#  when: ( korifi is defined and korifi == true ) and inventory_hostname in groups['master']


- name: Uninstall Korifi
  import_tasks: uninstall-korifi.yml
  tags: destroy
  when: ( korifi is defined and korifi == true ) and inventory_hostname in groups['master']


- name: Cleanup Korifi
  import_tasks: cleanup-korifi.yml
  tags: clean
  when: ( korifi is defined and korifi == true ) and inventory_hostname in groups['master']


- name: Uninstall K8S CLIs
  import_tasks: uninstall-cli.yml
  tags: uninstall
  when: ( cli is defined and cli == true ) and inventory_hostname in groups['master']


- name: Uninstall Cert Manager
  import_tasks: uninstall-cert-manager.yml
  tags: uninstall
  when: ( cm is defined and cm == true ) and inventory_hostname in groups['master']


- name: Uninstall GO
  import_tasks: uninstall-go.yml
  tags: uninstall
  when: ( go is defined and go == true ) and inventory_hostname in groups['master']


- name: Disable Helm Repository
  import_tasks: disable-helm-repo.yml
  tags: uninstall, disable
  when: ( repo is defined and repo == true ) and inventory_hostname in groups['master']

# https://dashaun.com/posts/korifi-on-raspberry-pi/

