---
- name: Copy LoadBalancer Config Yaml for MariaDB and phpMyAdmin
  template:
    src: "{{ item }}.j2"
    dest: "{{ base_path }}/{{ item }}"
  register: copy_lb_config_yaml
  with_items:
    - "mariadb-loadbalancer.yaml"
    - "phpmyadmin-loadbalancer.yaml"
- debug: msg={{ copy_lb_config_yaml }}


# kubectl apply -f {{ item }}
- name: Apply Load Balancer for MariaDB and phpMyAdmin
  shell: |
    kubectl patch svc phpmyadmin -n phpmyadmin -p '{"spec": {"type": "LoadBalancer", "loadBalancerIP": "{{ phpmyadmin.lb_ip_addr }}"}}'
  register: apply_lb
  ignore_errors: yes
  args:
    chdir: "{{ base_path }}"
  # with_items:
  #  - "mariadb-loadbalancer.yaml"
  #  - "phpmyadmin-loadbalancer.yaml"
- debug: msg={{ apply_lb }}

